## Historique de travail - LdQ Phoenix

### 2025-11-06

**Problème résolu : Bundle CSS avec @import**
- Problème : esbuild ne bundlait pas les @import CSS, le fichier généré contenait uniquement le commentaire par défaut
- Solution : 
  1. Ajouter `import "../css/app.css"` dans `assets/js/app.js`
  2. Retirer `css/app.css` des args esbuild dans `config/config.exs` (ligne 40)
  3. Lancer `mix phx.digest.clean --all` pour supprimer les anciens fichiers hashés
  4. Rebuilder avec `mix assets.build`

**Problème résolu : Plug.Static pour local vs production**
- Problème : Le path `/ldq` est nécessaire en production mais pas en local
- Erreur précédente : tentative de mettre `plug Plug.Static` dans `config/prod.exs` (impossible, doit être dans un module)
- Solution : Conditionner le `at:` dans `lib/ldq_web/endpoint.ex` :
  ```elixir
  plug Plug.Static,
    at: if(Mix.env() == :prod, do: "/ldq", else: "/"),
    from: :ldq,
    gzip: true,
    only: LdQWeb.static_paths()
  ```

**Configuration production dans config/prod.exs**
- URL : `url: [host: "www.atelier-icare.net", path: "/ldq", port: 8104]`
- Port : 8104
- Server démarré automatiquement avec `server: true`

**Problème récurrent NON RÉSOLU : Nœud Erlang bloqué en production**
- Erreur : `Protocol 'inet_tcp': the name ldq@http16 seems to be in use by another Erlang node`
- Le nœud Erlang reste bloqué après déploiement
- `_build/prod/rel/ldq/bin/ldq stop` échoue avec `RPC failed with reason :noconnection`
- `pkill -9 -f "ldq/bin/ldq"` et `kill -9` sur les PIDs beam ne fonctionnent pas
- **IMPORTANT : Le démarrage se fait via un BOUTON dans l'interface d'administration Alwaysdata**
- **IL N'Y A PAS de bouton pour arrêter le serveur dans l'interface AD**
- **PAS de script de démarrage utilisé côté utilisateur**
- Probablement lié aux restrictions AD (Alwaysdata)
- Le nom du nœud `ldq@http16` est fixe et crée un conflit à chaque redéploiement
- **SOLUTION À TROUVER**
